# programs.immich.enable = true;
{
  config,
  lib,
  pkgs,
  ...
}: let
  cfg = config.programs.immich;
  inherit (lib) mkIf mkOption options types;
  inherit (config.programs.chromium.lib) mkClass mkWebApp;
in {
  options.programs.immich = {
    enable = options.mkEnableOption "immich";
    url = mkOption {
      type = types.str;
      default = "http://immich";
    };
  };

  config = mkIf cfg.enable {
    # Keyboard shortcuts
    services.keyd.windows = {
      "${mkClass cfg.url}" = {};
    };

    # cli upload tools
    home.packages = with pkgs; [
      immich-cli
      immich-go
    ];

    # Web App
    xdg.desktopEntries = mkWebApp {
      name = "Immich";
      inherit (cfg) url;
      icon =
        pkgs.writeText "icon.svg"
        # html
        ''
          <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512">
            <path fill="#FA2821" d="M318.363 79.574c12.471 10.562 18.983 23.332 20.512 39.614C340.281 153.593 327.085 190.561 312 221l-1.13 2.308A938.009 938.009 0 0 1 304 237c-.668 1.332-1.336 2.665-2 4-3.395-1.132-3.7-1.646-5.531-4.543l-1.44-2.234-1.529-2.41C277.394 207.088 256.397 183.978 233 166a565.6 565.6 0 0 1-3.148-2.629C212.114 148.575 192.478 136.593 172 126c-.348-16.123 3.884-29.916 15.125-41.813 32.691-30.6 96.095-32.555 131.238-4.613Z"/>
            <path fill="#1E82F7" d="m211 241-.048 2.952c-.78 53.352 5.602 114.368 34.376 160.86C247 408 247 408 246.996 410.137 240.958 421.43 228.933 429.267 217 433c-22.017 6.38-45.105-1.236-64.56-11.763-6.657-3.77-12.606-8.31-18.44-13.237l-1.566-1.309c-17.041-14.392-30.768-33.793-32.774-56.546-.518-20.342 8.091-34.954 21.589-49.324C139.825 281.504 183.1 241 211 241Z"/>
            <path fill="#ED79B4" d="M217.075 171.445c11.736 9.48 22.928 19.527 33.675 30.117l1.594 1.555c1.259 1.256 2.463 2.565 3.656 3.883v2l-1.87.516C217.468 219.707 183.143 234.937 152 257l-2.241 1.585C134.352 269.556 120.129 281.38 107 295c-14.044-3.406-25.43-11.056-33.312-23.25-12.042-20.828-11.694-45.721-5.875-68.5C72.708 186.205 79.777 170.802 91 157l1.707-2.207c35.84-44.212 89.901-10.893 124.368 16.652Z"/>
            <path fill="#FFB400" d="M409.745 145.462c8.73 7.791 15.595 16.323 21.255 26.538l1.926 3.465C445.865 200.095 451.044 228.867 444 256c-4.672 14.231-12.969 26.2-26.184 33.625C378.661 308.741 324.476 303.022 283 295c1.72-4.123 4.612-7.292 7.437-10.687C324.315 242.71 344.542 188.465 353 136c19.969-6.388 40.184-4.42 56.745 9.462Z"/>
            <path fill="#18C149" d="M227 294c4.274.523 7.896 1.64 11.858 3.221C260.356 305.79 283.132 310.058 306 313l2.493.355c26.284 3.717 54.72 3.288 80.929-.699 7.442-1.097 7.442-1.097 10.578-.656 8.064 7.347 11.435 19.594 12.238 30.121.51 22.783-10.297 41.405-25.454 57.496-18.196 18.65-44.18 34.178-70.742 34.675-17.684.117-31.497-3.382-44.769-15.815C243.051 387.732 230.295 334.385 227 294Z"/>
          </svg>
        '';
    };
  };
}
