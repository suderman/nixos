# programs.harvest.enable = true;
{
  config,
  lib,
  pkgs,
  ...
}: let
  cfg = config.programs.harvest;
  inherit (lib) mkIf mkOption options types;
  class = config.lib.chromium.mkClass {
    inherit (cfg) url profile;
    keydify = true;
  };
in {
  options.programs.harvest = {
    enable = options.mkEnableOption "harvest";
    url = mkOption {
      type = types.str;
      default = "https://nonfictionstudios.harvestapp.com/";
    };
    profile = mkOption {
      type = with lib.types; nullOr str;
      default = "work";
    };
  };

  config = mkIf cfg.enable {
    services.keyd.windows."${class}" = {
      "super.[" = "A-left"; # back
      "super.]" = "A-right"; # forward
    };
    xdg.desktopEntries = config.lib.chromium.mkWebApp {
      name = "Harvest";
      inherit (cfg) url profile;
      icon =
        pkgs.writeText "icon.svg"
        # html
        ''
          <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512"><path fill="#FA5D00" d="M0 0h512v512H0V0Z"/><path fill="#FEF4EA" d="m133.875 104.938 2.953.013c2.39.012 4.781.028 7.172.049a106204.032 106204.032 0 0 1 .165 121.38l.002 2.578c.013 13.772.037 27.544.064 41.316.029 14.131.045 28.262.051 42.393.004 8.72.017 17.44.042 26.16.016 5.979.02 11.958.017 17.937-.002 3.45 0 6.9.017 10.35.015 3.741.011 7.483.003 11.225l.026 3.298C144.334 390.65 142.26 396.42 136 403h-2l-1 3c-3.178 1.06-5.426 1.115-8.762 1.098l-3.388-.01-3.537-.026-3.573-.013c-2.913-.012-5.827-.028-8.74-.049a80668.732 80668.732 0 0 1-.22-122.18l-.003-2.595c-.017-13.862-.049-27.724-.086-41.586-.037-14.225-.06-28.45-.067-42.674-.006-8.777-.023-17.553-.056-26.33-.02-6.02-.027-12.038-.022-18.058.003-3.472-.001-6.944-.023-10.417-.02-3.767-.015-7.534-.004-11.302l-.035-3.314c.058-7.442 1.176-12.98 6.446-18.603l1.945-1.379 1.93-1.433c5.802-2.984 12.718-2.247 19.07-2.192ZM407 105v288h-2l-.32 1.773c-.775 2.54-1.803 3.873-3.555 5.852l-1.555 1.79c-4.738 4.785-10.255 4.627-16.629 4.683a944.355 944.355 0 0 1-5.378-.036l-2.795-.013c-2.256-.012-4.512-.028-6.768-.049a160877.463 160877.463 0 0 1-.111-124.506c-.01-13.835-.025-27.67-.043-41.505-.019-14.191-.03-28.383-.034-42.575-.003-8.76-.012-17.52-.028-26.28-.01-6.003-.014-12.007-.011-18.011.001-3.466 0-6.932-.011-10.398-.01-3.755-.008-7.51-.003-11.266l-.017-3.328.012-3.05-.002-2.626c.573-5.67 3.618-10.217 7.248-14.455 8.771-6.747 22.094-4 32-4Z"/><path fill="#FEF5ED" d="m187.438 105.75 3.662.055c2.967.047 5.933.112 8.9.195.093 27.52.164 55.04.207 82.561.02 12.779.049 25.557.095 38.335.04 11.137.065 22.273.074 33.41.006 5.898.018 11.795.047 17.692.027 5.551.035 11.102.03 16.653 0 2.037.008 4.074.024 6.111.02 2.783.015 5.565.004 8.348l.035 2.438c-.067 6.407-1.87 10.714-6.41 15.413l-1.918 1.414-1.895 1.46C188 331 188 331 181 332v75h-20a156482.581 156482.581 0 0 1-.11-119.989l-.001-2.548c-.01-13.613-.025-27.225-.043-40.838-.019-13.97-.03-27.94-.034-41.91-.003-8.62-.012-17.238-.028-25.857a7958 7958 0 0 1-.011-17.736c.001-3.41 0-6.82-.011-10.23-.01-3.7-.008-7.402-.003-11.104l-.017-3.245c.034-8.585.441-16.783 6.258-23.543 6.455-4.953 12.533-4.474 20.438-4.25Z"/><path fill="#FEF7EF" d="M331 105h19a81283.142 81283.142 0 0 1 .22 122.235l.003 2.595c.017 13.87.049 27.739.086 41.608.037 14.23.06 28.46.067 42.69.006 8.782.023 17.564.056 26.345.02 6.021.027 12.042.022 18.063-.003 3.475.001 6.949.023 10.423.02 3.768.015 7.535.004 11.304l.035 3.322c-.06 7.704-1.466 11.903-6.579 17.79C342 403 342 403 339 404l-1 2h-26c-.093-27.373-.164-54.746-.207-82.118-.02-12.71-.049-25.42-.095-38.13-.04-11.077-.065-22.155-.074-33.233a4321.03 4321.03 0 0 0-.047-17.597c-.027-5.522-.035-11.044-.03-16.566 0-2.026-.008-4.05-.024-6.076a745.47 745.47 0 0 1-.004-8.308l-.035-2.417c.059-5.576 1.35-9.919 4.516-14.555 4.988-4.87 7.498-5.062 15-6v-76Z"/><path fill="#FEF6EE" d="M237.259 218.773h3.76l4.032.032 4.149.008c3.628.008 7.256.028 10.884.05 3.707.02 7.414.03 11.121.04 7.265.02 14.53.055 21.795.097.07 8.11.123 16.22.155 24.332.016 3.766.037 7.532.071 11.299.033 3.637.05 7.275.059 10.912.005 1.385.016 2.77.032 4.155.022 1.946.023 3.892.024 5.838l.02 3.35c-.414 3.572-1.592 6.01-3.361 9.114h-2l-1 3c-14.934 7.467-33.303 3-50 3v112h-20c-.07-22.027-.123-44.054-.155-66.081-.016-10.228-.037-20.456-.071-30.684-.03-8.915-.05-17.831-.056-26.747-.004-4.72-.013-9.44-.035-14.159-.02-4.445-.027-8.89-.022-13.336-.001-1.628-.007-3.257-.019-4.886-.126-18.798-.126-18.798 6.233-25.982l1.43-1.68c3.911-3.334 7.964-3.692 12.954-3.672Z"/></svg>
        '';
    };
  };
}
